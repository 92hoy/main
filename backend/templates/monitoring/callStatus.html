<%inherit file="../common/main_base.html"/>

<%!
from django.utils.translation import ugettext as _
%>

<%block name="containor">
<div class="padding" id="callstatus_chart">
    <div class="box">
        <div class="box-header">
            <h2>CALL STATUS</h2>
            <small>CALL STATUS</small>
        </div>
    </div>

    <div class="box">
        <canvas id="call_Chart"></canvas>
    </div>
</div>
</%block>
<%block name="script_callStatus">
<%block name="scriptDown">
<script>
var c_init = new Date();
        var c_initTime = ("0" + c_init.getHours()).slice(-2) + ":" + ("0" + c_init.getMinutes()).slice(-2) + ":" + ("0" + c_init.getSeconds()).slice(-2);

        c_init.setTime(c_init.getTime() - 10000);
        var c_initTimeMinus10 = ("0" + c_init.getHours()).slice(-2) + ":" + ("0" + c_init.getMinutes()).slice(-2) + ":" + ("0" + c_init.getSeconds()).slice(-2);

        c_init.setTime(c_init.getTime() - 10000);
        var c_initTimeMinus20 = ("0" + c_init.getHours()).slice(-2) + ":" + ("0" + c_init.getMinutes()).slice(-2) + ":" + ("0" + c_init.getSeconds()).slice(-2);

        c_init.setTime(c_init.getTime() - 10000);
        var c_initTimeMinus30 = ("0" + c_init.getHours()).slice(-2) + ":" + ("0" + c_init.getMinutes()).slice(-2) + ":" + ("0" + c_init.getSeconds()).slice(-2);

        c_init.setTime(c_init.getTime() - 10000);
        var c_initTimeMinus40 = ("0" + c_init.getHours()).slice(-2) + ":" + ("0" + c_init.getMinutes()).slice(-2) + ":" + ("0" + c_init.getSeconds()).slice(-2);

        var call_queue = [c_initTimeMinus30,c_initTimeMinus30, c_initTimeMinus20, c_initTimeMinus10, c_initTime]

    $(document).ready(function() {

        var call_total = [0, 0, 0, 0, 0]
        var callLegsActive       = [0, 0, 0, 0, 0]
        var callLegsMaxActive    = [0, 0, 0, 0, 0]
        var call_dataSet = [
            {
                label: "Active Call",
                borderColor: "#e8c3b9",
                fill: false,
                data: call_total
            },
            {
                label: "Active CallLeg",
                borderColor: "#3e95cd",
                fill: false,
                data: callLegsActive
            },
            {
                label: "Max CallLeg",
                borderColor: "#8e5ea2",
                fill: false,
                data: callLegsMaxActive
            }
        ];
        function call_syncChart() {
            setInterval(function(){

                var d = new Date();
                var currTime = ("0" + d.getHours()).slice(-2) + ":" + ("0" + d.getMinutes()).slice(-2) + ":" + ("0" + d.getSeconds()).slice(-2);

                call_queue.push(currTime);
                call_queue.shift();

                $.get( "/callStatus", {
                            //...
                        })
                        .done(function( context ) {

                            /*
                            audioBitRateOutgoing.push(Number(context['audioBitRateOutgoing']));
                            audioBitRateIncoming.push(Number(context['callLegsActive']));
                            videoBitRateOutgoing.push(Number(context['callLegsMaxActive']));
                            videoBitRateIncoming.push(Number(context['videoBitRateIncoming']));
                            */

                            // sample
                            call_total.push(Number(context['call_total']));
                            callLegsActive.push(Number(context['callLegsActive']));
                            callLegsMaxActive.push(Number(context['callLegsMaxActive']));

                            call_total.shift();
                            callLegsActive.shift();
                            callLegsMaxActive.shift();

                            call_myLineChart.data.datasets[0]['data'] = call_total;
                            call_myLineChart.data.datasets[1]['data'] = callLegsActive;
                            call_myLineChart.data.datasets[2]['data'] = callLegsMaxActive;
                            call_myLineChart.update();
                            /*
                             console.log(queue);
                             console.log(audioBitRateOutgoing);
                             console.log(callLegsActive);
                             console.log(callLegsMaxActive);
                             console.log(videoBitRateIncoming);
                             */
                        });
            } ,2000);
        }
        call_syncChart();
    });



    var call_canvas = document.getElementById('call_Chart');
    var call_data={
        labels: call_queue,
        datasets: [
            {
                label: "Active_call",
                borderColor: "#F28282",
                fill: false,
                data: [4, 4, 4, 4, 4]
            },
            {
                label: "callLegsActive",
                borderColor: "#C7E886",
                fill: false,
                data: [3, 3, 3, 3, 3]
            },
            {
                label: "callLegsMaxActive",
                borderColor: "#FAB9F1",
                fill: false,
                data: [2, 2, 2, 2, 2]
            },
        ]
    };
    var call_option = {
        showLines: true
    };
    var call_myLineChart = Chart.Line(call_canvas,{
        data:call_data,
        options:call_option
    });



</script>
</%block>
</%block>