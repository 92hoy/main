<%inherit file="../common/main_base.html"/>

<%!
from django.utils.translation import ugettext as _
%>

<%block name="containor">
<style>
.pagination .active .page-link, .pagination .active a{
  background-color: #6e8df4 !important;
  border-color: #6e8df4 !important
}

td{
  border: solid 1px #dddddd;
  padding: 3px;
}

.rightTd{
width:100%
}
</style>

<div class="dim-layer">
    <div class="dimBg"></div>
    <div id="layer2" class="pop-layer">
        <div class="pop-container">
            <div class="pop-conts">

          <span class="nav-icon" style="padding-bottom: 18px;">
            <i class="fa fa-plug"></i>
          </span>
          <div style="margin-bottom: 20px;">
            Conference management<a href="#" class="btn-layerClose" style="float: right;">X</a>
          </div>

          <div style="text-align: center;">
              <table style="display: inline-block; width:100%;">
                      <tbody>
                        <tr>
                          <td>Conference name</td>
                          <td class="rightTd"><input type="text" class="form-control" placeholder=""></td>
                        </tr>
                        <tr>
                          <td>uri</td>
                          <td class="rightTd"><input type="text" class="form-control" placeholder=""></td>
                        </tr>
                        <tr>
                          <td>secondaryUri</td>
                          <td class="rightTd"><input type="text" class="form-control" placeholder=""></td>
                        </tr>
                        <tr>
                          <td>callId</td>
                          <td class="rightTd"><input type="text" class="form-control" placeholder=""></td>
                        </tr>
                        <tr>
                          <td>cdrTag</td>
                          <td class="rightTd"><input type="text" class="form-control" placeholder=""></td>
                        </tr>
                        <tr>
                          <td>passcode</td>
                          <td class="rightTd"><input type="text" class="form-control" placeholder=""></td>
                        </tr>
                        <tr>
                          <td>Confirm password</td>
                          <td class="rightTd"><input type="text" class="form-control" placeholder=""></td>
                        </tr>
                        <tr>
                          <td>defaultLayout</td>
                          <td class="rightTd">
                            <select id="inputState" class="custom-select w-100">
                              <option selected="">Choose...</option>
                              <option>...</option>
                            </select>
                          </td>
                        </tr>
                        <tr>
                          <td>ownerJid</td>
                          <td class="rightTd"><input type="text" class="form-control" placeholder=""></td>
                        </tr>
                        <tr>
                          <td>template</td>
                          <td class="rightTd">
                            <select id="inputState" class="custom-select w-100">
                              <option selected="">Choose...</option>
                              <option>...</option>
                            </select>
                          </td>
                        </tr>
                        <tr>
                          <td>streamUrl</td>
                          <td class="rightTd"><input type="text" class="form-control" placeholder=""></td>
                        </tr>
                        <tr>
                          <td>ownerAdGuid</td>
                          <td class="rightTd"><input type="text" class="form-control" placeholder=""></td>
                        </tr>
                        <tr>
                          <td>MeetingScheduler</td>
                          <td class="rightTd"><input type="text" class="form-control" placeholder=""></td>
                        </tr>
                      </tbody>
                    </table>

                <button class="md-btn md-raised mb-2 w-xs blue" id="confSave">SAVE</button>

            </div>
            </div>
        </div>
    </div>
</div>

<style>
.pop-layer .pop-container {
  padding: 20px 25px;
}

.pop-layer p.ctxt {
  color: #666;
  line-height: 25px;
}

.pop-layer {
  width: 100%;
  margin: 10px 0 20px;
  padding-top: 10px;
}

.pop-layer {
  display: none;
  position: absolute;
  top: 50%;
  left: 50%;
  width: 410px;
  height: auto;
  background-color: #fff;
  border: 5px solid #3571B5;
  z-index: 10;
}

.dim-layer {
  display: none;
  position: fixed;
  _position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 100;
}

.dim-layer .dimBg {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #000;
  opacity: .5;
  filter: alpha(opacity=50);
}

.dim-layer .pop-layer {
  display: block;
}

</style>

<div class="padding">

  <div class="box">
    <div class="box-header">
      <h2>CONFERENCE ROOM</h2>
      <small>You can see the current meeting status</small>
    </div>
  </div>

  <div class="box" style="padding: 10px;">

      <div style="padding: 10px;">

        <div style="float: left; margin-right: 10px; padding-top:6px;">Search</div>
        <input type="text" class="form-control" id="search_str" placeholder="Search" required="" style="width:20%; float: left; margin-right:10px;">
        <button id="search_btn" class="md-btn md-raised mb-2 w-xs white" style="float: left">Search</button>

        <button class="md-btn md-raised mb-2 w-xs red" id="delBtn" style="float: right;">DEL</button>

        <a href="#layer2" class="btn-example">
          <button class="md-btn md-raised mb-2 w-xs indigo dialog__trigger" id="addBtn" style="float: right; margin-right: 8px;">ADD</button>
        </a>

      </div>

      <div class="table-responsive">
        <table class="table table-bordered">

          <thead style="background-color: #6e8df4; color: #ffffff">
            <tr>
              <th style="width:5%"><input type="checkbox"/></th>
              <th style="width:35%">Conference Name</th>
              <th style="width:10%">URI</th>
              <th style="width:15%">Secondary URI</th>
              <th style="width:10%">Call ID</th>
              <th style="width:10%">CDR Tag</th>
              <th style="width:15%">View</th>
            </tr>
          </thead>

          <tbody id="tbody">
          </tbody>

        </table>
      </div>

      <div style="text-align: center;">
        <div id="paging"></div>
      </div>

    </div>
</div>

<input type="hidden" id="all_pages" value="6">
<input type="hidden" id="curr_page" value="1">
</%block>


<%block name="scriptDown">
<script>

var total_page = "";
var cur_page = "";
var start_page = 1;

$(document).ready(function () {
    search(1);

    $("#search_btn").click(function () {
        search(1);
    });

    $("#search_str").keyup(function (e) {
        if (e.keyCode == 13)
            search(1);
    });

    $("#delBtn").click(function () {
        alert("del");
    });

    $("#confSave").click(function () {
        alert("save");
    });

    /*
    $("#addBtn").click(function () {
        alert("add");
    });
    */
});

function search(page_no) {

    var hidden_csrftoken = $('.hidden_csrftoken').text();

    console.log("page_no = " + page_no);

    if (page_no > 1 && $("#curr_page").val() == page_no) {
        console.log("----------------> if 1");
        return;
    }

    if (page_no){
        console.log("----------------> if 2");
        $("#curr_page").val(page_no);
    }

    $.post('/commList',
        {
            page_size : 10,
            curr_page : $("#curr_page").val(),
            search_str : $("#search_str").val(),
            csrfmiddlewaretoken: hidden_csrftoken
        },
    function (context) {

        var data = context.curr_data;
        var all_pages = context.totalPage;

        var curr_page = Number($("#curr_page").val());
        $("#all_pages").val(all_pages);

        var html = "";
        //for table
        for (var i = 0; i < data.length; i++) {

          html += '<tr>';
          html += '<td><input type="checkbox"></td>';
          html += '<td>'+ data[i]['name'] +'</td>';
          html += '<td>'+ data[i]['uri'] +'</td>';
          html += '<td></td>';
          html += '<td>'+ data[i]['callId'] +'</td>';
          html += '<td></td>';
          html += '<td><button class="btn btn-fw accent">VIEW</button></td>';
          html += '</tr>';

          $('#tbody').html(html);
        }

        var paging = "";
        var page_size = 5;

        var minNum = Math.floor((curr_page - 1) / page_size) * page_size + 1;
        var maxNum = minNum + page_size - 1;

        if (maxNum > all_pages)
            maxNum = all_pages;

        console.log(minNum + ":" + maxNum);

        paging += '<ul class="pagination" style="display: inline-flex;">';
        paging += '<li class="page-item">';
        paging += '<a class="page-link" id="first" href="#" aria-label="Previous">';
        paging += '<span aria-hidden="true">«</span>';
        paging += '<span class="sr-only">Previous</span>';
        paging += '</a>';
        paging += '</li>';
        paging += '<li class="page-item">';
        paging += '<a class="page-link" id="prev" href="#" aria-label="Previous">';
        paging += '<span aria-hidden="true"><</span>';
        paging += '<span class="sr-only">Previous</span>';
        paging += '</a>';
        paging += '</li>';
        for (var i = minNum; i <= maxNum; i++) {
            if (i == curr_page)
                paging += '<li class="page-item active"><a id="'+ i +'" class="page-link" href="#">'+ i +'</a></li>';
            else
                paging += '<li class="page-item"><a id="'+ i +'" class="page-link" href="#">'+ i +'</a></li>';
        }
        paging += '<li class="page-item">';
        paging += '<a class="page-link" id="next" href="#" aria-label="Next">';
        paging += '<span aria-hidden="true">></span>';
        paging += '<span class="sr-only">Next</span>';
        paging += '</a>';
        paging += '</li>';
        paging += '<li class="page-item">';
        paging += '<a class="page-link" id="last" href="#" aria-label="Next">';
        paging += '<span aria-hidden="true">»</span>';
        paging += '<span class="sr-only">Next</span>';
        paging += '</a>';
        paging += '</li>';
        paging += '</ul>';
        $('#paging').html(paging);

        fnPaging();
      });
}

function fnPaging() {
    $("#paging a").click(function () {
        var id = $(this).attr("id");
        var all_pages = $("#all_pages").val();
        var curr_page = $("#curr_page").val();
        var curr_page = $("#curr_page").val();
        var prev_page = Number($("#curr_page").val()) - 1 > 0 ? Number($("#curr_page").val()) - 1 : 1;
        var next_page = Number($("#curr_page").val()) + 1 <= all_pages ? Number($("#curr_page").val()) + 1 : all_pages;
        var last_page = all_pages;

        if (id == curr_page)
            return;
        if (id == 'first' && curr_page == '1')
            return;
        if (id == 'prev' && curr_page == prev_page)
            return;
        if (id == 'next' && curr_page == next_page)
            return;
        if (id == 'last' && curr_page == last_page)
            return;

        if (id == 'first')
            search(1);
        else if (id == 'prev')
            search(prev_page);
        else if (id == 'next')
            search(next_page);
        else if (id == 'last')
            search(last_page);
        else
            search(id);

        console.debug('id: ' + id);
        console.debug('curr_page: ' + curr_page);
        console.debug('prev_page: ' + prev_page);
        console.debug('next_page: ' + next_page);
        console.debug('last_page: ' + last_page);

    });
}

$('.btn-example').click(function(){
    var $href = $(this).attr('href');
    layer_popup($href);
});

function layer_popup(el){

    var $el = $(el);        //레이어의 id를 $el 변수에 저장
    var isDim = $el.prev().hasClass('dimBg');   //dimmed 레이어를 감지하기 위한 boolean 변수

    isDim ? $('.dim-layer').fadeIn() : $el.fadeIn();

    var $elWidth = ~~($el.outerWidth()),
        $elHeight = ~~($el.outerHeight()),
        docWidth = $(document).width(),
        docHeight = $(document).height();

    // 화면의 중앙에 레이어를 띄운다.
    if ($elHeight < docHeight || $elWidth < docWidth) {
        $el.css({
            marginTop: -$elHeight /2,
            marginLeft: -$elWidth/2
        })
    } else {
        $el.css({top: 0, left: 0});
    }

    $el.find('a.btn-layerClose').click(function(){
        isDim ? $('.dim-layer').fadeOut() : $el.fadeOut(); // 닫기 버튼을 클릭하면 레이어가 닫힌다.
        return false;
    });

    $('.layer .dimBg').click(function(){
        $('.dim-layer').fadeOut();
        return false;
    });

}
</script>
</%block>
